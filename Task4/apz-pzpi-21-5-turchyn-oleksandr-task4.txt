Тема: Розробка клієнтської частини програмної системи.

Мета: Написати програмний код для реалізації клієнтської / frontend частини програмної системи для попереднього замовлення їжі та напоїв: створити розмітку сторінок сайту для відображення предметної області, забезпечити отримання даних з БД за допомогою API, наданих серверною частиною, застосувати стилі для представлення інформації користувачеві у найзручнішому і найпривабливішому вигляді. Передбачити локалізацію та інтернаціоналізацію інтерфейсів користувача та адміністрування.

Хід роботи:
1.	Створення React-компонентів для відображення предметної області, що моделюється, реалізація бізнес-логіки.
2.	Написання для створених компонентів HTTP-запитів до API з метою отримання необхідних даних із серверної частини застосунку.
3.	Створення інтерфейсу адміністрування, забезпечення можливості створення резервних копій, відновлення бази даних за допомогою створених копій, реалізація захисту даних шляхом надання можливості управління сертифікатами.
4.	Локалізація та інтернаціоналізація користувацького інтерфейсу та інтерфейсу адміністрування.
5.	Побудова UML діаграм: діаграми прецедентів (Use Case Diagram), діаграми компонентів (Component Diagram), діаграми станів (State Diagram) та діаграми пакетів (Package Diagram).

1	ОПИС ВЕБ ЧАСТИНИ ПРОЄКТУ
1.1	Діаграма прецедентів

Для наочного відображення й розуміння дій користувача в ході використання програми було спроектовано UseCase UML діаграму 
(див. додаток А). 
Із неї чітко видно, що акторами, які безпосередньо взаємодіють із системою, є адміністратор, який здійснює управління системою і відповідає за її працездатність, користувачі, що мають платну підписку чи безкоштовний акаунт і взаємодіють із системою для замовлення і отримання їжі, а також працівники закладів громадського харчування.

1.2	Опис ролей

Адміністратор має необмежений доступ до функціоналу керування системою. У його обов’язки входить створення резервних копій бази даних, її відновлення у разі припинення нормального функціонування програмного продукту, здійснення керування сертифікатами, що включає у себе відслідковування строку дії SSL-сертифікату та його оновлення у разі потреби. Та основною роботою, що здійснює даний актор, є керування даними системи. Він керує даними таблиць бази даних, а саме: додає нові дані до таблиць, редагує наявні таблиці, може видаляти зайві сутності, а також переглядати усі дані, пов’язані із таблицею і її вмістом.
Користувач із безкоштовним акаунтом може використовувати основний функціонал, що дозволить йому отримати приготовану страву. Він може У закладі харчування у мобільному додатку зчитати NFC-мітку, після чого отримає доступ до каталогу страв, що пропонує даний заклад харчування. Після цього є можливість переглянути усі страви, що його цікавлять, у чому може допомогти можливість фільтрації, сортування каталогу, а також функція пошуку у ньому, ознайомитися із інформацією про страви, визначити її наповнення та додати до кошику, відредагувати вміст кошику та зробити замовлення, яке буде приготовано і можна буде отримати відповідно до черги. Даний користувач має право здійснити пошук закладів харчування, що можуть приготувати вибрані ним страви і знаходяться у тій місцевості, яку він вкаже, а також знайти страви, котрі складаються із вибраних користувачем інгредієнтів, при цьому даному актору можна вибрати, скільки із вказаних інгредієнтів може бути відсутніми у складі рецепту страви.
Користувач, що маж платну підписку, може здійснити замовлення страви онлайн на вибраний ним час, а також має привілеї при розрахування черги: він може переміститися одразу в середину черги, яка складається лише з користувачів із безкоштовною підпискою.
Взаємодію із системою також здійснює працівник закладу харчування. Коли у пристрої для приготування страви не вистачає певних інгредієнтів, від повідомляє про це і даний актор повинен поповнити запаси інгредієнтів для підтримки обслуговування системою користувачів.

2	ОПИС АРХІТЕКТУРНОГО РІШЕННЯ
2.1	Компоненти програмної системи

Для надання уявлення про склад програмних компонентів, з яких складається система, було створено діаграму компонентів (див. додаток Б). Із неї видно, що основним файлом, який містить розмітку і відповідає за відображення усієї необхідної інформації користувачеві, є index.html. Застосунок було розроблено у відповідності до концепції single page додатків, тобто за допомогою скриптів змінюється вміст одного файлу розмітки (index.html) замість створення окремого файлу для кожної логічної сторінки сайту. 
Відповідає за генерацію необхідного вмісту веб-сторінки файл App.js, який відслідковує поточну URL-адресу та на основі цієї інформації визначає, який із React-компонентів використати для отримання розмітки. Деякі компоненти, такі як Registration, Authorization, Catalog, Dish, DishSearcher, IngredientsForm, CateringEstablishmentSearcher використовують функціонал бібліотеки axios за допомогою компоненту RequestManager для виконання HTTP-запитів до API серверної частини. За встановлення стилів загально відповідає файл App.css. Локалізація та інтернаціоналізація здійснюється завдяки використанню бібліотеки i18next. 

2.2	Пакети програмної системи 

Створені React-компоненти розділено по пакетах, як показано на діаграмі пакетів (див. додаток В). За генерування шапки та тіла сайту відповідають окремі пакети: Header та Body відповідно. Пакет Body містить під пакети: Administration (містить компоненти сторінки адміністрування: основні, такі як кнопки для відновлення БД, створення резервних копій, оновлення сертифікатів, а також компоненти з окремими таблицями БД для здійснення керування ними), Searchers (складається із компонентів, які відповідають за пошук сутностей предметної області за обраними користувачем параметрами, наприклад, страв, закладів харчування), Catalog (компоненти, що призначені для відображення каталогу страв, які можуть бути приготовані у закладах харчування в рамках системи), Authentication (реєстрація та авторизація користувачів).

2.3	Стани програмної системи

Для опису поведінки окремо узятого об'єкта системи, насамперед реактивного (поведінка якого характеризується його реакцією на зовнішні події) було розроблено діаграму станів (див. додаток В). Детально показано такі стани користувача, як неавторизований та активний, процес переходу від одного стану до іншого. Чітко видно, в яких станах перебуває об’єкт в рамках експлуатації системи, які кроки потрібно пройти, аби перейти з одного стану в інший.

2.3.1	Сторінки, на які розділена веб частина

Веб-сайт містить наступні сторінки:
-	каталог страв, що можуть бути приготовані у закладах, підключених до системи і занесених до БД. Про кожну страву виводиться така інформація, як назва, зображення, вид, популярність та короткий опис. Є можливість здійснити пошук в рамках каталогу, здійснювати фільтрацію за типом, популярністю та рейтингом. Дані можуть бути відсортовані за назвою, зростанням чи спаданням рейтингу. Фрагмент коду генерації списку страв каталогу наведено у додаток Д;
-	детальна інформація про вибрану із каталогу страву. Містить назву, зображення, інгредієнти, вартість із обраним складом інгредієнтів, вид, популярність та короткий опис. Можна переглянути відгуки та написати власний зареєстрованим користувачам;
-	сторінка пошуку страв, що можна приготувати із вибраних користувачем інгредієнтів. На сторінці присутній випадаючий список, при натисканні на елемент якого відповідний інгредієнт додається до вибраних, що також стає зрозумілим із візуального відображення списку. При повторному натисканні інгредієнт вважається невибраним. Також є поле, у якому можна вказати числове значення, що відповідає можливій кількості інгредієнтів, що можуть бути відсутніми у стравах. При натисканні на кнопку пошуку для кожної із знайдених страв у вигляді картки відображається така інформація, як назва, тип та зображення. Фрагмент коду сторінки для пошуку страв, що складаються із вказаних інгредієнтів, наведено у додаток Ж;
-	сторінка пошуку закладів, у яких можуть бути приготовані вибрані користувачем страви. Присутній випадаючий список, елементами якого є страви. При натисканні на кнопку пошуку для знайдених закладів відображається назва, його адреса та зображення;
-	сторінка реєстрації, де відвідувач може вказати свої персональні дані для входу на сайт (логін та пароль, вимоги до якого вказані на даній сторінці), аби в подальшому мати можливість за допомогою них авторизуватися;
-	сторінка авторизації, де пропонується увести логін та пароль для автентифікації на сайті;
-	сторінка адміністратора, на якій здійснюється управляння користувачами (додавання та вилучення, редагування особистих даних, відновлення паролю, налаштування прав доступу до даних) та даними з БД, які моделюють предметну область (додавання, редагування, видалення). Реалізовано функціонал, що відповідає за автоматичне створення резервних копій з інтервалом в одну годину та за запитом адміністратора (при натисканні на відповідну кнопку), відновлення БД із створеної резервної копії, експорт та імпорт даних та налаштувань, їх міграція на інші платформи. Забезпечено захист даних: адміністратор може переглянути, чи є дійсним SSL-сертифікат та оновити його у разі потреби. Після проведення кожної із вищезазначених дій з’являється повідомлення про успіх чи помилку, що сталася під час її виконання.
Кожна сторінка сайту підтримує локалізацію та інтернаціоналізацію: створено .json-файли, які містять переклади окремих складових інтерфейсу, які використовує бібліотека i18next для відображення даних вибраною мовою (українською чи англійською). За перемикання мови відповідає кнопка в шапці сайту. Дата та час визначається у відповідності до поточного часового поясу та відображається у форматі, специфічному для вибраної мови. Створено функціонал, що дозволяє відображати масу в одиницях виміру, характерних для різних країн. Якщо мова інтерфейсу українська, маса визначається у грамах, якщо ж англійська – у фунтах. Ціна аналогічним чином відображається у доларах чи гривнях відповідно до поточних налаштувань мови, курс валют визначається HTTP-запитом до API, наданим ПриватБанком.

3	АРХІТЕКТУРНЕ РІШЕННЯ ПРОГРАМНОЇ СИСТЕМИ

Архітектура програмної системи є двошаровою однорівневою: уся система фізично розміщена на одному сервері та поділяється на два шари: шар бізнес-логіки та шар відображення даних. У шарі бізнес-логіки відбувається «розумний пошук» та обчислення ціни, конвертація даних відповідно до обраних налаштувань мови, а у шарі відображення – у зручному для сприйняття користувачем вигляді подано дані предметної області. Використовується шаблон Singleton – клас RequestManager, який створюється в єдиному екземплярі у файлі App.js та передається у властивостях дочірнім компонентам. Саме за допомогою методів даного класу відбувається генерація HTTP-запитів до серверної частини програмної системи. Фрагмент реалізації даного класу наведено у додатку Е.

ВИСНОВКИ

У ході даної лабораторної роботи було розроблено клієнтську частину програмної системи: створено розмітку сторінок сайту для відображення предметної області, забезпечено отримання даних з БД за допомогою API, наданих серверною частиною, застосовано стилі для представлення інформації користувачеві у найзручнішому і найпривабливішому вигляді. Передбачено локалізацію та інтернаціоналізацію інтерфейсів користувача та адміністрування.

Додаток А
Діаграма прецедентів

Додаток Б
Діаграма компонентів

Додаток В
Діаграма пакетів
 
Додаток Г
Діаграма станів

Додаток Д
Фрагмент коду генерації списку страв у каталозі

1	// Створення списку страв каталогу за обраними фільтрами
2	const getDishList = () => {
3	
4	    return(
5	        <div id='catalog-dishes-container'>
6	            {dishesList.map(dish =>
7	                <Card className={
8	                    [getDishCardStyle.root, 
9	                        'catalog-card'].join(' ')}>
10	                    <CardHeader
11	                        action={
12	                            <div className='catalog-card-action'>
13	                                <Rating
14	                                    name="read-only"
15	                                    value={dish.rate}
16	                                    readOnly
17	                                />
18	                                <div>
19	                                    {
20	                                        dish.popularity && 
21	                                        <Chip
22	                                            label={dish.popularity}
23	                                            color='primary' />
24	                                    }
25	                                </div>
26	                            </div>
27	                        }
28	                        title={dish.name}
29	                        subheader={dish.type}
30	                    />
31	                    <CardContent>
32	                        <img src={dish.image} />
33	                        <Typography 
34	                            variant="body2"
35	                            color="textSecondary"
36	                            component="p">
37	                            {dish.description.slice(0, 366)}
38	                        </Typography>
39	                    </CardContent>
40	                </Card>
41	            )}
42	        </div>
43	    }
44	);
 
Додаток Е
Фрагмент реалізації класу Singleton
 
1	export default class RequestManager {
2	    constructor() {
3	        this.makeRequest = this.makeRequest.bind(this);
4	        this.makePostRequest = this.makePostRequest.bind(this);
5	        this.makeGetRequest = this.makeGetRequest.bind(this);
6	        this.getAuthHeader = this.getAuthHeader.bind(this);
7	    }
8	    makeRequest(requestMethod, apiUrl, requestHeaders, requestData) {
9	        return axios(
10	            {
11	                method: requestMethod,
12	                url: apiUrl,
13	                headers: requestHeaders,
14	                data: requestData,
15	            });
16	    }
17	    makePostRequest(apiUrl, requestHeaders, requestData) {
18	        return this.makeRequest(
19	            'post', apiUrl, requestHeaders, requestData);
20	    }
21	    makeGetRequest(apiUrl, requestHeaders, requestData) {
22	        return this.makeRequest(
23	            'get', apiUrl, requestHeaders, requestData);
24	    }
25	    getAuthHeader() {
26	        return {
27	            'Authorization': 'JWT ' + localStorage.getItem('fap_access')
28	        }
29	    }
30	}
 
Додаток Ж
Фрагмент коду сторінки для пошуку страв, що складаються із вказаних інгредієнтів
 
1	// Формування частини посилання для виконання GET-запиту до сервера з 
2	// метою отримання списку страв, що можуть бути приготовані 
3	// із інгредієнтів, сказаних користувачем
4	const getSearchDishesParams = () => {
5	    let params_string = '';
6	    for (let ingredient of ingredients) {
7	        if (ingredientName.includes(ingredient.name)) {
8	            params_string += '&0=' + ingredient.id;
9	        }
10	    }
11	    const maxMissedCount =
12	        document.getElementById('filled-number').value;
13	    params_string += '&1=' + maxMissedCount;
14	    return '?' + params_string.slice(1);
15	}
16	
17	// Отримання списку відповідних страв із оновленням стану компоненту
18	const getAppropriateDishes = () => {
19	    const requestParams = getSearchDishesParams();
20	    const requestApi = process.env.REACT_APP_API_URL +
21	        process.env.REACT_APP_APPROPRIATE_DISHES + requestParams;
22	    const headers = props.requestManager.getAuthHeader();
23	
24	    props.requestManager.makeGetRequest(requestApi, headers, {})
25	        .then(response => {
26	            setDishes(response.data);
27	        });
28	}